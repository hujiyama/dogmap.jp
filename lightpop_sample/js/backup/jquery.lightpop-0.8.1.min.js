/**
 * jQuery lightpop plugin
 * This jQuery plugin was inspired on jQuery lightBox plugin by Leandro Vieira Pinho (http://leandrovieira.com/projects/jquery/lightbox/)
 * @name jquery.lightpop-0.8.1.min.js
 * @author wokamoto - http://dogmap.jp
 * @version 0.8.1
 * @date July 22, 2009
 * @category jQuery plugin
 * @copyright (c) 2007-2009 wokamoto (dogmap.jp)
 * @license  Released under the GPL license (http://www.gnu.org/copyleft/gpl.html)
 * @example http://dogmap.jp/lightpop_sample/sample.html
 */
(function(a){a.browser=a.extend({chrome:/chrome/i.test(navigator.userAgent)},a.browser);a.fn.lightpop=function(M,B,z,f,g,t){z=z||"lightpop";f=f||"images/";g=g||f+z+"-";t=t||f+"icon-";M=a.extend(true,{overlayBgColor:"#000",overlayOpacity:0.7,contentFrameType:"border",contentBorder:"none",boxBorderSize:6,containerBorderSize:10,containerResizeSpeed:"normal",contentBgColor:"#FFF",imageBox:g+"box.gif",imageBorderL:g+"border-l.gif",imageBorderR:g+"border-r.gif",imageLoading:g+"ico-loading.gif",imageBtnPrev:g+"btn-prev.gif",imageBtnNext:g+"btn-next.gif",imageBtnClose:g+"btn-close.gif",imageBlank:g+"blank.gif",imageBtnPrevWidth:63,imageBtnNextWidth:63,imageBtnCloseWidth:66,txtImage:null,txtOf:"of",setLinkToTitle:false,keyToClose:"c",keyToPrev:"p",keyToNext:"n",flvplayer:"flvplayer.swf",iconAdd:true,detailsEnabled:true,initSize:250,defaultLater:1500,grouping:true,Image:{enabled:true,icon:t+"image.png",param:{},size:new Array(0,0)},Contents:{enabled:true,icon:t+"contents.png",param:{},size:new Array(0,0),iframeEnabled:true},Video:{enabled:true,icon:t+"video.png",param:{},size:new Array(320,240)},YouTube:{enabled:true,icon:t+"youtube.png",param:{hl:"ja"},size:new Array(425,355)},Metacafe:{enabled:true,icon:t+"metacafe.png",param:{},size:new Array(400,345)},LiveLeak:{enabled:true,icon:t+"liveleak.png",param:{},size:new Array(450,370)},GoogleVideo:{enabled:true,icon:t+"googlevideo.png",param:{hl:"ja"},size:new Array(400,326)},ifilm:{enabled:true,icon:t+"ifilm.png",param:{},size:new Array(448,365)},Dailymotion:{enabled:true,icon:t+"dailymotion.png",param:{},size:new Array(420,330)},superdeluxe:{enabled:true,icon:t+"superdeluxe.png",param:{},size:new Array(400,350)},nicovideo:{enabled:true,icon:t+"nicovideo.png",param:{},size:new Array(312,176)}},M);if(M.imageMaxWidth||M.imageMaxHeight){M=a.extend(true,M,{Image:{size:new Array((M.imageMaxWidth||0),(M.imageMaxHeight||0))}})}var i=/^border$/i.test(M.contentFrameType);var F=new Array();F.length=0;var Q=document,E=window;var R=Q.body,O=Q.documentElement,k=Q.images;var l=a.browser.msie,D=a.browser.mozilla,C=a.browser.opera,m=a.browser.safari||a.browser.chrome;B=a.extend(true,{Image:{match:function(b){return(M.Image.enabled&&/\.(jpe?g|gif|png|bmp)$/i.test(b))},defaultSize:M.Image.size,set:function(b){x(b,true)},preload:function(b){x(b,false)}},Video:{match:function(b){return(M.Video.enabled&&/\.(flv|swf|rm|mov|3gp|mp4|asf|avi|mpg|wmv)$/i.test(b))},defaultSize:M.Video.size,getInfo:function(X,U,Y,Z,d,W){W=W||X.replace(/\?.*$/,"");var V={};var aa="true";var e=false;var b={rm:{id:"CFCDAA03-8BE4-11CF-B84B-0020AFBBCCFA",type:"audio/x-pn-realaudio-plugin"},mp4:{id:"02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",type:"video/quicktime",url:"http://www.apple.com/qtactivex/qtplugin.cab"},wmv:{id:"6BF52A52-394A-11d3-B153-00C04F79FAA6",type:"application/x-oleobject",url:"http://www.microsoft.com/windows/windowsmedia"}};var w=W.toLowerCase().match(/\.(flv|swf|rm|mov|3gp|mp4|asf|avi|mpg|wmv)$/i)[1];switch(w){case"flv":Y+=22;V={flashvars:"movieURL="+W+"&autoStart="+aa};W=M.flvplayer+"?file="+W;case"swf":V=a.extend(true,V,{quality:"high",bgcolor:"#000"});W=v(W,U,Y,V);break;case"rm":V={autostart:aa,controls:"imagewindow,controlpanel"};W=c(W,b.rm.id,b.rm.type,U,Y,V,"","",e,true);break;case"mov":case"mp4":case"3gp":Y+=20;V={href:W,controller:"true",pluginspage:"http://www.apple.com/quicktime/download/",autoplay:aa,bgcolor:"000000"};W=c(W,b.mp4.id,b.mp4.type,U,Y,V,' codebase="'+b.mp4.url+'"',"",e,true);break;case"wmv":default:Y+=20;if(w=="wmv"){V={URL:W,AutoStart:aa,uiMode:"full"};e='src="'+W+'" name="player" width="'+U+'" height="'+Y+'" type="'+b.wmv.type+'" pluginurl="'+b.wmv.url+'" allowchangedisplaysize="1" autosize="1" displaysize="1" showcontrols="1" showstatusbar="0" autorewind="1" autostart="'+(aa=="false"?"0":"1")+'"'}else{V={href:W,autostart:aa,uiMode:"full"}}W=c(W,b.wmv.id,b.wmv.type,U,Y,V,"","",e,false);break}return{content:W,width:U,height:Y,later:Math.round(M.defaultLater*2/3)}}},YouTube:{match:function(b){return(M.YouTube.enabled&&/\.youtube\.com\/watch/i.test(b))},base:"www.youtube.com/v/",defaultSize:M.YouTube.size,getInfo:function(U,d,V,W,b,X,w){X=X||U.replace(/^.*\?v=(.*)$/i,"$1");w=w||b.base+X;var e={allowFullScreen:"true"};for(var Y in W){if(/^fmt$/i.test(Y)){w+="&ap=%2526fmt%3D"+W[Y]}else{w+="&"+Y+"="+W[Y];if(!/^hl$/i.test(Y)){e[Y]=W[Y]}if(!/^fs$/i.test(Y)){e.allowFullScreen=(W[Y]=="1"?"true":"false")}}}w=v(w,d,V,e);return{content:w,width:d,height:V,later:M.defaultLater}}},Metacafe:{match:function(b){return(M.Metacafe.enabled&&/\.metacafe\.com\/watch/i.test(b))},base:"www.metacafe.com/fplayer/",defaultSize:M.Metacafe.size,getInfo:function(W,V,e,X,U,b,w){b=b||W.replace(/^.*\/watch\/([\d]+\/[^\/]*)\/?.*$/i,"$1");w=w||U.base+b+".swf";var d={};w=v(w,V,e,d,X);return{content:w,width:V,height:e,later:M.defaultLater}}},LiveLeak:{match:function(b){return(M.LiveLeak.enabled&&/\.liveleak\.com\/view/i.test(b))},base:"www.liveleak.com/player.swf?autostart=false&amp;token=",defaultSize:M.LiveLeak.size,getInfo:function(W,V,e,X,U,b,w){b=b||W.replace(/^.*\?i=(.*)$/i,"$1");w=w||U.base+b;var d={quality:"high"};w=v(w,V,e,d,X);return{content:w,width:V,height:e,later:M.defaultLater}}},GoogleVideo:{match:function(b){return(M.GoogleVideo.enabled&&/video\.google\.com\/videoplay/i.test(b))},base:"video.google.com/googleplayer.swf?docId=",defaultSize:M.GoogleVideo.size,getInfo:function(W,V,e,X,U,b,w){b=b||W.replace(/^.*\?docid=([a-z\d\-]+).*$/i,"$1");w=w||U.base+b;var d={flashvars:""};w=v(w,V,e,d,X);return{content:w,width:V,height:e,later:M.defaultLater}}},ifilm:{match:function(b){return(M.ifilm.enabled&&/\.ifilm\.com\/video/i.test(b))},base:"www.ifilm.com/efp",defaultSize:M.ifilm.size,getInfo:function(W,V,e,X,U,b,w){b=b||W.replace(/\?.*$/,"").replace(/^.*\/video\/([^\/]*)[\/]?$/i,"$1");w=w||U.base;w=v(w,V,e,d,X);var d={flashvars:"flvbaseclip="+b+"&",quality:"high",bgcolor:"000000"};return{content:w,width:V,height:e,later:M.defaultLater}}},Dailymotion:{match:function(b){return(M.Dailymotion.enabled&&/\.dailymotion\.com\/video/i.test(b))},base:"www.dailymotion.com/swf/",defaultSize:M.Dailymotion.size,getInfo:function(W,V,e,X,U,b,w){b=b||W.replace(/^.*\/video\/([^_]*).*$/i,"$1");w=w||U.base+b;var d={allowFullScreen:"true",allowScriptAccess:"always"};w=v(w,V,e,d,X);return{content:w,width:V,height:e,later:M.defaultLater}}},superdeluxe:{match:function(b){return(M.superdeluxe.enabled&&/\.superdeluxe\.com\/sd/i.test(b))},base:"i.cdn.turner.com/sdx/static/swf/share_vidplayer.swf",defaultSize:M.superdeluxe.size,getInfo:function(W,V,e,X,U,b,w){b=b||W.replace(/^.*\?id=(.*)$/i,"$1");w=w||U.base;var d={allowFullScreen:"true",FlashVars:"id="+b};w=v(w,V,e,d,X);return{content:w,width:V,height:e,later:M.defaultLater}}},nicovideo:{match:function(b){return(M.nicovideo.enabled&&/\.nicovideo\.jp\/watch/i.test(b))},base:"www.nicovideo.jp/watch/",defaultSize:M.nicovideo.size,getInfo:function(V,U,d,W,w,b,e){b=b||V.replace(/^.*\/watch\/(.*)$/i,"$1");e=e||w.base+b;e='<iframe width="'+U+'" height="'+d+'" src="http://www.nicovideo.jp/thumb/'+b+'" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="'+e+'">'+w.tytle+"</iframe>";return{content:e,width:U,height:d,later:Math.round(M.defaultLater/3)}}},Contents:{match:function(b){return(M.Contents.enabled&&RegExp(E.location.host,"i").test(b)&&!/\.(jpe?g|gif|png|bmp)$/i.test(b))},defaultSize:M.Contents.size,set:function(e,b){var w=q(F[e].href);var d='width="'+w[0]+'" height="'+w[1]+'"';if(M.Contents.iframeEnabled){b="<iframe "+d+' src="'+F[e].href+'" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="'+F[e].href+'">'+F[e].tytle+"</a></iframe>";F[e]=a.extend(F[e],{content:b,width:w[0],height:w[1],later:500});L(e)}else{a.get(F[e].href,function(V,U){b="<div "+d+">"+V.replace(/[\r\n]/g,"").replace(/.*<body.*?>(.*?)<\/body>.*$/,"$1").replace(/<script.*?>.*<\/script>/g,"")+"</div>";F[e]=a.extend(F[e],{content:b,width:w[0],height:w[1],later:500});L(e)})}},preload:function(b){},content_css:{textAlign:"left",lineHeight:"1.2em"}}},B);var j={overlay:"overlay",lightpop:z,box:z+"-box",inner:z+"-box-inner",content:z+"-content",nav:z+"-nav",next:z+"-nav-prev",prev:z+"-nav-next",data:z+"-data",wrap:z+"-data-wrap",close:z+"-data-close",details:z+"-details",caption:z+"-details-caption",number:z+"-details-number",loading:z+"-loading"},N={};for(var r in j){N[r]="#"+j[r]}var J=function(b,e){T(M.imageBtnPrev,function(w){M.imageBtnPrevWidth=(w.width>0?w.width:M.imageBtnPrevWidth);T(M.imageBtnNext,function(U){M.imageBtnNextWidth=(U.width>0?U.width:M.imageBtnNextWidth);T(M.imageBtnClose,function(V){M.imageBtnCloseWidth=(V.width>0?V.width:M.imageBtnCloseWidth);if(!i){T(M.imageBox,function(W){T(M.imageBorderL,function(X){T(M.imageBorderR,function(Y){M.contentBorder="none"})})})}})})});e=e||new Array();var d=0;b.filter("a").each(function(){var w=E.location;var X=a(this);if(!/^https?:/i.test(X.attr("href"))&&/^https?:/i.test(w.protocol)){X.attr("href",(/^\//i.test(X.attr("href"))?w.protocol+"//"+w.hostname+"/"+X.attr("href"):w.href.replace(/^(.*\/).*$/i,"$1")+X.attr("href").replace(/^\/?(.*)$/i,"$1")))}for(var V in B){var U=B[V];if(U.match(X.attr("href").replace(/\?.*$/,""))){var W=M[V];if(M.iconAdd&&X.children("img").length===0){X.css({background:"transparent url("+W.icon+") no-repeat scroll 1px 0pt",paddingLeft:"20px"})}F.push({type:V,href:X.attr("href"),title:X.attr("title")||X.html().replace(/<[^>]*>/ig,""),base:(U.base?"http://"+U.base:"/")});X.unbind("click").click((function(Y){return function(){u(Y);return false}})(d));e.push(this);d++;break}}});return new a(e)};var u=function(X,W,w,V,e){M.grouping=(F.length>1?M.grouping:false);h(a("embed, object, select"),false);W=W||'<div id="'+j.content+'-wrap"><div id="'+j.content+'" /></div>';w=w||(M.detailsEnabled?'<div id="'+j.wrap+'"><div id="'+j.data+'"><div id="'+j.details+'"><div id="'+j.caption+'" /><div id="'+j.number+'" /></div><div id="'+j.data+'-nav"><a href="#" id="'+j.close+'"><img src="'+M.imageBtnClose+'" /></a></div></div></div>':"");V=V||'<div id="'+j.nav+'"><a href="#" id="'+j.prev+'" /><a href="#" id="'+j.next+'" /></div><div id="'+j.loading+'"><a href="#" id="'+j.loading+'-link"><img src="'+M.imageLoading+'" /></a></div>';e=e||'<div id="'+j.overlay+'" /><div id="'+j.lightpop+'"><div id="'+j.box+'"><div id="'+j.inner+'">'+(i?W+"</div>"+w:'<div id="'+j.box+'-hd"><div id="'+j.box+'-hdc" /></div><div id="'+j.box+'-bd"><div id="'+j.box+'-bdc">'+W+w+'</div></div><div id="'+j.box+'-ft"><div id="'+j.box+'-ftc" /></div></div>')+V+"</div></div>";a("body").append(a(e).hide());var Y=I();var b=K();var d=M.containerBorderSize;a(N.overlay+","+N.lightpop+","+N.nav+","+N.loading).css({position:"absolute"});a(N.box+","+N.data).css({position:"relative"});a(N.overlay).css({top:0,left:0,backgroundColor:M.overlayBgColor,opacity:M.overlayOpacity,width:Y.page.width,height:Y.page.height,zIndex:90});a(N.lightpop).css({top:b.top+Math.round(Y.window.height/10),left:b.left,width:"100%",height:0,overflow:"visible",textAlign:"center",lineHeight:0,border:"none",zIndex:100});a(N.lightpop+" a img").css({border:"none"});a(N.box).css({width:M.initSize,height:M.initSize,top:0,margin:"0 auto",padding:0,backgroundColor:M.contentBgColor,border:M.contentBorder,overflow:(i?"hidden":"visible")});a(N.inner).css({width:M.initSize,height:M.initSize,backgroundColor:"transparent",margin:"0 auto",padding:(i?d:0),overflow:(i?"hidden":"visible")});a(N.content+"-wrap").css({backgroundColor:"transparent"});a(N.content).css({margin:(i?0:"0 auto"),padding:(i?0:d+"px 0"),zIndex:110});if(!i){var U=M.boxBorderSize;y(false).css({position:"relative"}).hide();a(N.box+"-hd,"+N.box+"-hdc").css({height:U,top:0});a(N.box+"-ft,"+N.box+"-ftc").css({height:U,bottom:0});a(N.box+"-hd,"+N.box+"-ft").css({margin:"0 "+U+"px 0 0"});a(N.box+"-hdc,"+N.box+"-ftc").css({margin:"0 "+U*-1+"px 0 "+U+"px"})}a(N.nav).css({top:0,left:0,height:"10px",width:"100%",padding:0,margin:(i?"0":M.boxBorderSize+"px")+" auto",zIndex:10});a(N.nav+" a").css({display:"block",height:"100%",zoom:1,margin:(i?0:"0 "+M.boxBorderSize+"px"),outline:"none"});if(M.grouping){a(N.prev).css({width:M.imageBtnPrevWidth,left:0,styleFloat:"left"});a(N.next).css({width:M.imageBtnNextWidth,right:0,styleFloat:"right"})}else{a(N.prev+","+N.next).css({display:"none"})}a(N.loading).css({top:"40%",left:0,height:"20%",width:"100%",margin:"0 auto",textAlign:"center",lineHeight:0});if(M.detailsEnabled){a(N.wrap).css({font:"10px Verdana, Helvetica, sans-serif",backgroundColor:M.contentBgColor,lineHeight:"1.4em",width:"100%",margin:"0 auto",padding:"0 "+d+"px 0",overflow:"hidden"}).hide();a(N.data).css({padding:"0 "+d+"px",color:"#666",left:0,bottom:0});a(N.details).css({width:"70%",styleFloat:"left",textAlign:"left"});a(N.caption).css({styleFloat:"left","font-weight":"bold",width:"100%"});a(N.number).css({styleFloat:"left",clear:"left",width:"100%","padding-bottom":"1em"});a(N.close).css({styleFloat:"right",width:M.imageBtnCloseWidth,padding:".35em 0"})}a(N.overlay).fadeIn(M.containerResizeSpeed,function(){a(N.lightpop).show()});a(N.overlay+","+N.loading+"-link,"+N.close).click(function(){A();return false});S(true);p(X)};var p=function(b){h(a(N.data+","+N.details+","+N.caption+","+N.number+","+N.close),false);a(N.nav+","+N.prev+","+N.next).hide();a(N.content).hide().children().remove();a(N.loading+","+N.box+","+N.inner).show();y(false);if(M.detailsEnabled&&!i&&m){a(N.wrap).height("auto")}L(b)};var L=function(b){(F[b].content?function(d){a(N.content).append(a(F[d].content));setTimeout(function(){P(d)},F[d].later)}:(B[F[b].type].set?B[F[b].type].set:(function(d){n(d);L(d)})))(b)};var H=function(e,d,b,w){if(M.detailsEnabled){w=(w<28?28:w);b+=w}(i?(function(U){a(N.box).animate({width:d,height:b},"fast",function(){h(U,true)})}):(function(U){if(M.detailsEnabled&&m){a(N.wrap).height(w)}h(U,true)}))(e)};var P=function(X){var w=M.containerBorderSize,W=M.boxBorderSize,d=F[X],b=I(),V=K();var U=d.width+(w+(i?0:W))*2,e=d.height+w*2;a(N.lightpop).animate({top:V.top+Math.round(b.window.height/10),left:V.left},M.containerResizeSpeed,function(){a(N.box).animate({width:U,height:e},M.containerResizeSpeed,function(){var Y=B[d.type];a(N.inner).css({width:(i?d.width:U),height:d.height});a(N.content).css({width:d.width,height:d.height});if(M.detailsEnabled){a(N.wrap).css({width:d.width})}if(Y.content_css){a(N.content).children().css(Y.content_css)}a(N.loading).hide();if(/<object.*>/i.test(d.content)){a(N.content).show()}else{a(N.content).fadeIn()}y(true);a(N.caption).html((M.setLinkToTitle?'<a href="'+d.href+'" title="'+d.title+'">'+d.title+"</a>":d.title));a(N.number).html((M.txtImage||d.type)+(M.grouping&&F.length>1?" "+(X+1)+" "+M.txtOf+" "+F.length:""));var Z=h(a(N.data+","+N.details+","+N.caption+","+N.number+","+N.close),false).show();(M.detailsEnabled?function(ac,aa,ab){a(N.wrap).slideDown("fast",function(){H(ac,aa,ab,(!m?a(this).height():this.scrollHeight))})}:function(ac,aa,ab){H(ac,aa,ab)})(Z,U,e);a(N.nav).css({width:U}).show(function(){if(M.grouping){a(N.prev+","+N.next).css({height:Math.round(e/3),background:"transparent url("+M.imageBlank+") no-repeat"}).unbind();if(X!=0){a(N.prev).hover(function(){a(this).css({background:"url("+M.imageBtnPrev+") left 30% no-repeat"})},function(){a(this).css({background:"transparent url("+M.imageBlank+") no-repeat"})}).show().click((function(aa){return function(){p(aa);return false}})(X-1))}if(X!=(F.length-1)){a(N.next).hover(function(){a(this).css({background:"url("+M.imageBtnNext+") right 30% no-repeat"})},function(){a(this).css({background:"transparent url("+M.imageBlank+") no-repeat"})}).show().click((function(aa){return function(){p(aa);return false}})(X+1))}}G(true,X)});if(F.length-1>X){o(X+1)}if(X>0){o(X-1)}})})};var o=function(b){if(!F[b].content){(B[F[b].type].preload?B[F[b].type].preload:(function(d){n(d)}))(b)}};var q=function(e,d,W){var V=0,b=0;var U=e.toLowerCase().replace(/[\r\n]/g,"").replace(/["']/g,"").match(/(width|height)=(\d+)/ig);if(U){a.each(U,function(){if(/^width=\d+$/i.test(this)){V=Number(this.replace(/^width=(\d+)$/,"$1"))}if(/^height=\d+$/i.test(this)){b=Number(this.replace(/^height=(\d+)$/,"$1"))}})}if(V===0||b===0){if(d){V=d[0];b=d[1]}else{var w=I();V=w.page.width/4;b=w.page.height/4}}if(W){if(W[0]!=0&&V>W[0]){b=b*(W[0]/V);V=W[0]}if(W[1]!=0&&b>W[1]){V=V*(W[1]/b);b=W[1]}}return new Array(Math.round(V),Math.round(b))};var n=function(Y,X,U){var d,W={},e=F[Y];var b=M[e.type],w=B[e.type],V=e.href.replace(/&.*$/i,"");if(/\?.*$/.test(e.href)){var Z=e.href.replace(/^.*\?/,"").split("&");if(Z.length>0){a.each(Z,function(){var ab,aa=this.toString();if(!/^(width|height|v|i|docid|id)\=.*$/i.test(aa)){ab=(aa).match(/^([^=]*)=(.*)$/i);if(ab.length>2){W[ab[1]]=ab[2]}}})}}W=a.extend(W,b.param);d=q(e.href,w.defaultSize);F[Y]=a.extend(e,w.getInfo(V,d[0],d[1],W,e))};var v=function(d,U,b,W,V,w){if(typeof V==="object"){a.each(V,function(X){d+=(d.indexOf(X+"=")<0?(d.indexOf("?")<0?"?":"&")+X+"="+this:"")})}var e={movie:d,wmode:"transparent"};W=(W?a.extend(e,W):e);w=w||'<object width="'+U+'" height="'+b+'" data="'+d+'" wmode="'+W.wmode+'" type="application/x-shockwave-flash">';a.each(W,function(X){w+='<param name="'+X+'" value="'+this+'" />'});w+="</object>";return w};var c=function(d,V,aa,e,ab,U,ac,b,Z,Y){var X="",w="",W={src:d,width:e,height:ab,type:aa};U=(U?a.extend(W,U):W);X+='<object width="'+e+'" height="'+ab+'"'+(V!=" "?'classid="clsid:'+V+'"':"")+' type="'+aa+'" '+b+">";a.each(U,function(ad){X+='<param name="'+ad+'" value="'+this+'" />'});w+="<embed "+(Z!==false?Z:'width="'+e+'" height="'+ab+'"');if(Z===false){a.each(U,function(ad){w+=" "+ad+'="'+this+'"'})}w+=">"+(Y?'<noembed><a href="'+d+'">'+d+"</a></noembed>":"")+"</embed>";X+=w+"</object>";return X};var y=function(e){if(!i){var d=a(N.box+"-hd, "+N.box+"-hdc, "+N.box+"-bd, "+N.box+"-bdc, "+N.box+"-ft, "+N.box+"-ftc"),b="transparent";if(e){a(N.box).css({backgroundColor:b});a(N.box+"-hd").css({background:b+" url("+M.imageBox+") left top no-repeat"});a(N.box+"-hdc").css({background:b+" url("+M.imageBox+") right top no-repeat"});a(N.box+"-bd").css({background:M.contentBgColor+" url("+M.imageBorderL+") left top repeat-y"});a(N.box+"-bdc").css({background:b+" url("+M.imageBorderR+") right top repeat-y"});a(N.box+"-ft").css({background:b+" url("+M.imageBox+") left bottom no-repeat"});a(N.box+"-ftc").css({background:b+" url("+M.imageBox+") right bottom no-repeat"});d.show()}else{a(N.box).css({backgroundColor:M.contentBgColor});d.css({background:b})}return d}};var s=function(V){var b=V.width,d=V.height;if(typeof V.naturalWidth!=="undefined"){b=V.naturalWidth;d=V.naturalHeight}else{if(typeof V.runtimeStyle!=="undefined"){var U=V.runtimeStyle;var e={w:U.width,h:U.height};U.width="auto";U.height="auto";b=V.width;d=V.height;U.width=e.w;U.height=e.h}else{var e={w:V.width,h:V.height};V.removeAttribute("width");V.removeAttribute("height");b=V.width;d=V.height;V.width=e.w;V.height=e.h}}return{width:b,height:d,src:V.src}};var x=function(d,b){T(F[d].href,(function(w,e){return function(U){var V=q(U.src,new Array(U.width,U.height),M.Image.size);F[w]=a.extend(F[w],{content:'<img src="'+U.src.replace(/\?.*$/,"")+'" width="'+V[0]+'" height="'+V[1]+'" />',width:V[0],height:V[1],later:(l?250:100)});if(e){L(w)}}})(d,b))};var T=function(b,X,V,e,Y){X=X||function(){};V=V||function(){};e=e||10;Y=Y||2000;for(var d=0,W=k.length;d<W;++d){if(k[d].src===b&&k[d].complete){X(s(k[d]));return}}var w=new Image(),U=0;w.finish=false;w.onabort=w.onerror=function(){if(w.finish){return}w.finish=true;V(b)};w.onload=function(){w.finish=true;if(C&&!w.complete){V(b);return}X(s(w))};w.src=b;if(!w.finish&&Y){setTimeout(function(){if(w.finish){return}if(w.complete){w.finish=true;if(w.width){return}V(b);return}if((U+=e)>Y){w.finish=true;V(b);return}setTimeout(arguments.callee,e)},0)}};var h=function(d,b){return d.css({visibility:(b?"visible":"hidden")})};var G=function(b,d){a(Q).unbind("keydown");if(b){a(Q).keydown(function(U){var e=(U||event).keyCode;var w=(U?U.DOM_VK_ESCAPE:27);var V=String.fromCharCode(e).toLowerCase();if((V==M.keyToClose)||(V=="x")||(e==w)){A()}else{if(M.grouping){if(((V==M.keyToPrev)||(e==37))&&d!=0){p(d-1)}else{if(((V==M.keyToNext)||(e==39))&&d!=(F.length-1)){p(d+1)}}}}})}};var S=function(b){a(E).unbind("resize");if(b){a(E).resize(function(){var d=I(),e=K();a(N.overlay).css(d.page);a(N.lightpop).css({top:e.top+Math.round(d.window.height/10),left:e.left})})}};var I=function(){var U=(O&&O.scrollWidth?O:R),b=(Q.compatMode&&/backcompat/i.test(Q.compatMode)?R:O);var d=U.scrollWidth,w=U.scrollHeight,e=b.clientWidth,V=b.clientHeight;d=(d<e?d:e);w=(w<V?V:w);return{page:{width:d,height:w},window:{width:e,height:V}}};var K=function(){var b=(O&&O.scrollTop?O:R);return{left:b.scrollLeft,top:b.scrollTop}};var A=function(){h(a("object",a(N.lightpop)),false).remove();a(N.lightpop).height(a(N.box).height()).slideUp(function(){a(this).remove();a(N.overlay).fadeOut(function(){a(this).remove();h(a("embed, object, select"),true)})});G(false);S(false)};return J(this)}})(jQuery);
