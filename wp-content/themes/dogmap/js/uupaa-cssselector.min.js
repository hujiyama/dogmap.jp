/** uupaa-cssselector.js
 *
 * @author Takao Obara <com.gmail@js.uupaa>
 * @license uupaa-datascheme.js is licensed under the terms and conditions of the MIT licence.
 */
(function(){var B={VERSION:1},A={};A.mix=function(F,C,E){for(var D in C){F[D]=C[D]}return E?A.mix(F,E):F};A.mix(B,{CSS_QUICK:/^(\.|#)([0-9a-z\-_]+)$/i,CSS_ID:/^#([a-z0-9\_\-]+)/i,CSS_CLASS:/^\.([a-z0-9\_\-]+)/i,CSS_ATTR1:/^\[\s*([^\~\^\$\*\|\=\!\s]+)\s*([\~\^\$\*\|\!]?=)\s*([^\]]*)\s*\]/,CSS_ATTR2:/^\[\s*([^\]]*)\s*\]/,CSS_QUOTE:/^[\"\']?|[\"\']?$/g,CSS_PSEUDO:/^\:([\w\-]+)(?:\((.*)\))?/,CSS_ANB:/^(-?\d*)n((?:\+|-)?\d*)/,CSS_COMBO1:/^\s*([\>\+\~])\s*(\*|\w*)/,CSS_COMBO2:/^\s*(\*|\w*)/,CSS_GROUP:/^\s*,\s*/,CSS_GUARD:{title:0,id:0,name:0,"for":0},CSS_NG_ATTR:{"class":"className",htmlFor:"for"},CSS_OP:{"=":function(D,C){return D===C},"!=":function(D,C){return D!==C},"*=":function(D,C){return C.indexOf(D)!==-1},"^=":function(D,C){return C.indexOf(D)===0},"$=":function(D,C){return C.lastIndexOf(D)+D.length===C.length
},"~=":function(D,C){return(" "+C+" ").indexOf(D)!==-1},"|=":function(D,C){return D===C||C.substring(0,D.length+1)===D+"-"}}});A.ua={};A.ua._=navigator.userAgent;A.ua.opera=!!window.opera;A.ua.ie=!!document.uniqueID;A.ua.webkit=A.ua._.indexOf("WebKit")>=0;A.ua.version=A.ua.ie?parseFloat(A.ua._.match(/MSIE ([\d]\.[\d][\w]?)/)[1]):A.ua.gecko?parseFloat(A.ua._.match(/Gecko\/(\d{8})/)[1]):A.ua.webkit?parseFloat(A.ua._.match(/WebKit\/(\d+(?:\.\d+)*)/)[1]):A.ua.opera?opera.version():0;A.ua.ie8=A.ua.ie&&A.ua.version===8;A.ua.opera95=A.ua.opera&&parseInt(A.ua.version)>=10048;A.mix(A,{css:function(G,E){var D=G.replace(/^[\s]*|[\s]*$/g,""),C=E||document;try{return(!C.querySelector||D.indexOf(":contains")>-1)?A._css(D,C):Array.prototype.slice.call(C.querySelectorAll(D))}catch(F){(A.config.debug&1)&&A.die("uu.css(expr=%s)",G)
}return[]},_css:function(H,I){var n=document;var M=[],K=[I||n],N="",S="",Q=H,f,a,R,U;var Y,V,O;var W,i,J,T,e,G,D,C,d,c,b,P,h,Z,l={},k={};var X=0;var g=A.uid;var j=A.ua.ie||(A.ua.opera&&!A.ua.opera95);function L(p){var F,o,E;if(!isNaN(p)){E=parseInt(p);return function(m){return m===E}}if(p==="even"){return function(m){return((m-0)%2===0)&&((m-0)/2>=0)}}if(p==="odd"){return function(m){return((m-1)%2===0)&&((m-1)/2>=0)}}F=p.match(B.CSS_ANB);!F&&A.die("%s unsupported",p);o=parseInt(F[1]==="-"?-1:F[1]||1);E=parseInt(F[2]||0);switch(o){case 0:return function(m){return m===E};case 1:return function(m){return m>=E};case -1:return function(m){return m<=E}}return function(m){return((m-E)%o===0)&&((m-E)/o>=0)}}if((f=Q.match(B.CSS_QUICK))){if(f[1]==="#"){return[n.getElementById(f[2])]}d=" "+f[2]+" ";e=K[0].getElementsByTagName("*");
for(l={},Z=-1,W=0,J=e.length;W<J;++W){P=e[W];if(P.nodeType===1&&(" "+P.className+" ").indexOf(d)>-1){O="uid" in P?P.uid:(P.uid=++g._count);if(!(O in l)){M[++Z]=P,l[O]=true}}}return M}while(Q.length&&Q!==N){N=Q,f=null;if((f=Q.match(B.CSS_COMBO1))){V=f[2]?f[2].toUpperCase():"*";d=V==="*";a=[],Z=-1,l={},W=0,J=K.length;switch(f[1]){case">":for(;W<J;++W){for(P=K[W].firstChild;P;P=P.nextSibling){if(P.nodeType===1){if(d||P.tagName.toUpperCase()===V){O="uid" in P?P.uid:(P.uid=++g._count);if(!(O in l)){a[++Z]=P,l[O]=true}}}}}K=a;break;case"+":for(;W<J;++W){for(P=K[W].nextSibling;P;P=P.nextSibling){if(P.nodeType===1){if(d||P.tagName.toUpperCase()===V){a[++Z]=P}break}}}K=a;break;case"~":for(;W<J;++W){for(P=K[W].nextSibling;P;P=P.nextSibling){if(P.nodeType===1){if(d||P.tagName.toUpperCase()===V){O="uid" in P?P.uid:(P.uid=++g._count);
if(O in l){break}a[++Z]=P;l[O]=true}}}}K=a;break}}else{if((f=Q.match(B.CSS_COMBO2))){Y=f[1].toUpperCase()||"*";d=Y==="*";for(a=[],Z=-1,l={},W=0,J=K.length;W<J;++W){for(e=K[W].getElementsByTagName(Y),i=0,T=e.length;i<T;++i){P=e[i];if(P.nodeType===1){if(d||P.tagName.toUpperCase()===Y){O="uid" in P?P.uid:(P.uid=++g._count);if(!(O in l)){a[++Z]=P,l[O]=true}}}}}K=a}}f&&(Q=Q.slice(f[0].length));while(Q.length&&Q!==S){S=Q,f=null;switch(Q.charAt(0)){case"#":if((f=Q.match(B.CSS_ID))){G=f[1];U=n.getElementById(G);U&&(K=[U])}break;case".":if((f=Q.match(B.CSS_CLASS))){for(G=" "+f[1]+" ",a=[],Z=-1,W=0,J=K.length;W<J;++W){U=K[W];if((" "+U.className+" ").indexOf(G)>-1){a[++Z]=U}}K=a}break;case"[":if((f=Q.match(B.CSS_ATTR1))){G=f[1],D=f[2],C=f[3];if(A.ua.ie&&G in B.CSS_NG_ATTR){G=B.CSS_NG_ATTR[G]}d=G in B.CSS_GUARD;
U=C.replace(B.CSS_QUOTE,"");if(!d){U=U.toLowerCase()}if(D==="~="){U=" "+U+" "}for(a=[],Z=-1,W=0,J=K.length;W<J;++W){R=K[W].getAttribute(G);if(R&&B.CSS_OP[D](U,d?R:R.toLowerCase())){a[++Z]=K[W]}}K=a}else{if((f=Q.match(B.CSS_ATTR2))){d=A.ua.ie&&!A.ua.ie8;for(a=[],Z=-1,W=0,J=K.length;W<J;++W){U=K[W];if(d){e=U.getAttributeNode(f[1]);if(e&&e.specified){a[++Z]=U}}else{if(U.hasAttribute(f[1])){a[++Z]=U}}}K=a}}break;case":":if((f=Q.match(B.CSS_PSEUDO))){G=f[1],D=f[2];a=[],Z=-1,W=0,J=K.length;switch(G){case"root":a=[n.getElementsByTagName("html")[0]];break;case"enabled":d=function(E){return !E.disabled};for(;W<J;++W){U=K[W];d(U)&&(a[++Z]=U)}break;case"disabled":d=function(E){return E.disabled};for(;W<J;++W){U=K[W];d(U)&&(a[++Z]=U)}break;case"checked":d=function(E){return E.checked};for(;W<J;++W){U=K[W];
d(U)&&(a[++Z]=U)}break;case"contains":d=D.replace(B.CSS_QUOTE,"");for(;W<J;++W){U=K[W];((j?U.innerText:U.textContent).indexOf(d)>-1)&&(a[++Z]=U)}break;case"empty":d=0;for(;W<J;++W){U=K[W];for(P=U.firstChild;P;P=P.nextSibling){if(P.nodeType===1){++d;break}}(!d&&!(j?U.innerText:U.textContent))&&(a[++Z]=U)}break;case"target":if(!(d=location.hash.slice(1))){break}for(;W<J;++W){U=K[W];(U.id===d||("name" in U&&U.name===d))&&(a[++Z]=U)}break;case"lang":d=RegExp("^("+D+"$|"+D+"-)","i");for(;W<J;++W){U=K[W];while(U&&U!==n&&!U.getAttribute("lang")){U=U.parentNode}((U&&U!==n)&&d.test(U.getAttribute("lang")))&&(a[++Z]=K[W])}break;case"first-child":for(;W<J;++W){for(U=K[W],d=0,P=U.previousSibling;P;P=P.previousSibling){if(P.nodeType===1){++d;break}}!d&&(a[++Z]=U)}break;case"last-child":for(;W<J;++W){for(U=K[W],d=0,P=U.nextSibling;
P;P=P.nextSibling){if(P.nodeType===1){++d;break}}!d&&(a[++Z]=U)}break;case"only-child":for(;W<J;++W){U=K[W],d=0;for(P=U.nextSibling;P;P=P.nextSibling){if(P.nodeType===1){++d;break}}if(!d){for(P=U.previousSibling;P;P=P.previousSibling){if(P.nodeType===1){++d;break}}}!d&&(a[++Z]=U)}break;case"nth-child":if(!K.length){break}d=L(D),c=K[0].tagName.toUpperCase(),l={};for(;W<J;++W){h=K[W].parentNode;O="uid" in h?h.uid:(h.uid=++A.uid._count);if(!(O in l)){l[O]=true;for(i=0,P=h.firstChild;P;P=P.nextSibling){if(P.nodeType===1&&d(++i)&&P.tagName.toUpperCase()===c){a[++Z]=P}}}}break;case"nth-last-child":if(!K.length){break}d=L(D),c=K[0].tagName.toUpperCase(),l={};for(;W<J;++W){h=K[W].parentNode;O="uid" in h?h.uid:(h.uid=++A.uid._count);if(!(O in l)){l[O]=true;for(i=0,P=h.lastChild;P;P=P.previousSibling){if(P.nodeType===1&&d(++i)&&P.tagName.toUpperCase()===c){a[++Z]=P
}}}}break;case"nth-last-of-type":K.reverse();case"nth-of-type":d=L(D),c=null,b={};for(;W<J;++W){U=K[W];h=U.parentNode;(c!==h)&&(c=h,b={});(U.tagName in b)?++b[U.tagName]:(b[U.tagName]=1);d(b[U.tagName])&&(a[++Z]=U)}break;case"last-of-type":K.reverse();case"first-of-type":d=function(E){return E===1},c=null,b={};for(;W<J;++W){U=K[W];h=U.parentNode;(c!==h)&&(c=h,b={});(U.tagName in b)?++b[U.tagName]:(b[U.tagName]=1);d(b[U.tagName])&&(a[++Z]=U)}break;case"only-of-type":d=0;for(;W<J;++W){U=K[W];c=U.tagName.toUpperCase();for(P=U.nextSibling;P;P=P.nextSibling){if(P.nodeType===1&&P.tagName.toUpperCase()===c){++d;break}}if(!d){for(P=U.previousSibling;P;P=P.previousSibling){if(P.nodeType===1&&P.tagName.toUpperCase()===c){++d;break}}}if(!d){a[++Z]=U}}break;default:A.die(":%s unsupported",G)}K=a}}f&&(Q=Q.slice(f[0].length))
}if((f=Q.match(B.CSS_GROUP))){for(++X,Z=M.length-1,W=0,J=K.length;W<J;++W){U=K[W];O="uid" in U?U.uid:(U.uid=++A.uid._count);!(O in k)&&(M[++Z]=U,k[O]=true)}K=[I||n],N="",S="";Q=Q.slice(f[0].length)}}Q.length&&A.die("%s unsupported",Q);if(!X){return K}for(Z=M.length-1,W=0,J=K.length;W<J;++W){U=K[W];O="uid" in U?U.uid:(U.uid=++A.uid._count);!(O in k)&&(M[++Z]=U,k[O]=true)}return M}});A.die=function(C,F,E){var D=C.replace("%s",F);throw TypeError(D)};A.uid={_count:0};A.config={debug:0};if(!document.querySelectorAll){document.getElementsBySelector=A.css}})();